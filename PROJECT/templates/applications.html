<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="shortcut icon" href="static/icon.png" type="image/x-icon">
    <link href="/static/styles.css" rel="stylesheet" type="text/css"></link>
    <link href="/static/login.css" rel="stylesheet" type="text/css"></link>
    <style>#applicationRequestsList {
        margin-top: 20px; /* Пример верхнего отступа */
    }
    
    .application-request-item {
        border: 1px solid #ccc; /* Пример рамки для блока */
        padding: 15px; /* Внутренний отступ */
        margin-bottom: 15px; /* Отступ между блоками заявок */
        border-radius: 8px; /* Скругленные углы */
        background-color: #f9f9f9; /* Легкий фон */
    
        display: flex; /* Включаем Flexbox для расположения дочерних элементов */
        justify-content: space-between; /* Распределяем пространство между элементами */
        align-items: center; /* Выравниваем элементы по центру вертикали */
    }
    
    .request-info {
        flex-grow: 1; /* Позволяем блоку с информацией занимать все доступное пространство */
        margin-right: 20px; /* Отступ справа от информации перед кнопками */
    }
    
    .request-actions {
        /* Кнопки будут справа. Можно добавить стили для расположения самих кнопок, если их несколько. */
        display: flex; /* Используем Flexbox для кнопок, чтобы они были в ряд */
        flex-direction: column; /* Размещаем кнопки друг под другом */
        gap: 10px; /* Промежуток между кнопками */
    }
    
    .request-info h3 {
        margin-top: 0; /* Убираем стандартный верхний отступ у заголовка */
    }
    
    .request-info p {
        margin-bottom: 5px; /* Небольшой отступ между параграфами информации */
    }
    
    .request-info p:last-child {
        margin-bottom: 0; /* Убираем нижний отступ у последнего параграфа */
    }
    
    .approve-button,
    .reject-button {
        padding: 8px 15px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .approve-button {
        background-color: #4CAF50; /* Зеленый фон для одобрения */
        color: white;
    }
    
    .approve-button:hover {
        background-color: #45a049;
    }
    
    .reject-button {
        background-color: #f44336; /* Красный фон для отклонения */
        color: white;
    }
    
    .reject-button:hover {
        background-color: #d32f2f;
    }</style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Admin Panel</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/api/reports/pdf">Отчеты о общежитиях</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/apidocs">Редактирование БД</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/applications">Заявки на заселение</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin_profile">Профиль</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div id="applicationRequestsList">
        <div class="application-request-item">
            <div class="request-info">
                <h3>Заявка # [ID заявки]</h3>
                <p>Статус: [Статус заявки]</p>
                <p>Дата въезда: [Дата въезда]</p>
                <p>Дата выезда: [Дата выезда]</p>
                <p>ID комнаты: [ID комнаты]</p>
                <p>ID студента: [ID студента]</p>
                </div>
            <div class="request-actions">
                <button class="approve-button" data-request-id="[ID заявки]">Одобрить</button>
                <button class="reject-button" data-request-id="[ID заявки]">Отклонить</button>
            </div>
        </div>
    
        </div>
<script>// Получаем элемент, куда будем выводить список заявок
    const applicationRequestsListElement = document.getElementById('applicationRequestsList'); // Замени 'applicationRequestsList' на ID твоего HTML-элемента (например, <ul> или <div>)
    
    // URL твоего API эндпоинта для получения всех заявок
    const apiUrl = 'http://localhost:5000/api/application_requests'; // <-- Укажи правильный URL, если он отличается
    
    // TODO: Добавь URLы для API изменения статуса заявки (PUT запрос по ID)
    const approveApiUrl = 'http://localhost:5000/api/application_requests/'; // Добавь сюда ID заявки
    const rejectApiUrl = 'http://localhost:5000/api/application_requests/'; // Добавь сюда ID заявки
    
    
    // Функция для получения и отображения заявок со статусом 0
    async function fetchAndDisplayPendingApplicationRequests() {
        try {
            const response = await fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                    // Авторизация, если нужна
                }
            });
    
            if (!response.ok) {
                throw new Error(`Ошибка HTTP: ${response.status}`);
            }
    
            const data = await response.json();
    
            if (data && Array.isArray(data.requests)) {
                applicationRequestsListElement.innerHTML = '';
    
                const pendingRequests = data.requests.filter(request => request.status === '0');
    
                if (pendingRequests.length === 0) {
                    applicationRequestsListElement.innerHTML = '<p>Нет заявок на переселение в статусе "0".</p>';
                } else {
                    pendingRequests.forEach(request => {
                        const requestElement = document.createElement('div');
                        // Добавляем класс для основного блока заявки
                        requestElement.classList.add('application-request-item');
                        // Сохраняем ID заявки в атрибуте для удобства
                        requestElement.dataset.requestId = request.id; // Добавляем data-request-id
    
                        // Формируем HTML содержимое с двумя блоками: информацией и действиями
                        requestElement.innerHTML = `
                            <div class="request-info">
                                <h3>Заявка #${request.id}</h3>
                                <p>Статус: ${request.status}</p>
                                <p>Дата въезда: ${request.date_entr || 'Не указана'}</p>
                                <p>Дата выезда: ${request.date_exit || 'Не указана'}</p>
                                <p>ID комнаты: ${request.room_id}</p>
                                <p>ID студента: ${request.student_id}</p>
                            </div>
                            <div class="request-actions">
                                <button class="approve-button" data-request-id="${request.id}">Одобрить</button>
                                <button class="reject-button" data-request-id="${request.id}">Отклонить</button>
                            </div>
                        `;
    
                        // Добавляем элемент заявки в список на странице
                        applicationRequestsListElement.appendChild(requestElement);
                    });
    
                    // TODO: Добавить слушателей событий для кнопок после того, как все заявки добавлены
                    attachButtonListeners();
    
                }
    
            } else {
                console.error('Неверный формат данных от API:', data);
                applicationRequestsListElement.innerHTML = '<p>Не удалось загрузить данные заявок из-за ошибки формата.</p>';
            }
    
        } catch (error) {
            console.error('Ошибка при получении заявок:', error);
            applicationRequestsListElement.innerHTML = `<p>Произошла ошибка при загрузке заявок: ${error.message}</p>`;
        }
    }
    
    // TODO: Реализовать эту функцию для добавления обработчиков кликов на кнопки
    function attachButtonListeners() {
        // Находим все кнопки "Одобрить"
        const approveButtons = document.querySelectorAll('.approve-button');
        approveButtons.forEach(button => {
            button.addEventListener('click', handleApproveClick);
        });
    
        // Находим все кнопки "Отклонить"
        const rejectButtons = document.querySelectorAll('.reject-button');
        rejectButtons.forEach(button => {
            button.addEventListener('click', handleRejectClick);
        });
    }
    
    // TODO: Реализовать эти функции для обработки кликов по кнопкам
    async function handleApproveClick(event) {
        const requestId = event.target.dataset.requestId; // Получаем ID заявки из атрибута data-request-id
        console.log(`Нажата кнопка "Одобрить" для заявки ID: ${requestId}`);
    
        // TODO: Отправить PUT запрос к API для изменения статуса заявки на "Одобрено" (например, статус '1')
        // const response = await fetch(`${approveApiUrl}${requestId}`, {
        //     method: 'PUT',
        //     headers: {
        //         'Content-Type': 'application/json' // или 'application/x-www-form-urlencoded' в зависимости от API PUT
        //         // Авторизация, если нужна
        //     },
        //     body: JSON.stringify({ status: '1' }) // Отправляем новый статус
        // });
        //
        // if (response.ok) {
        //     console.log(`Заявка ${requestId} одобрена.`);
        //     // TODO: Обновить интерфейс: удалить этот блок заявки или изменить его внешний вид
        //     // event.target.closest('.application-request-item').remove(); // Пример удаления блока
        // } else {
        //     console.error(`Ошибка при одобрении заявки ${requestId}: ${response.status}`);
        //     alert(`Не удалось одобрить заявку ${requestId}.`);
        // }
    
        // После обработки (одобрения/отклонения) можно обновить список заявок
        // fetchAndDisplayPendingApplicationRequests();
    }
    
    async function handleRejectClick(event) {
        const requestId = event.target.dataset.requestId; // Получаем ID заявки из атрибута data-request-id
        console.log(`Нажата кнопка "Отклонить" для заявки ID: ${requestId}`);
    
        // TODO: Отправить PUT запрос к API для изменения статуса заявки на "Отклонено" (например, статус '2')
        // const response = await fetch(`${rejectApiUrl}${requestId}`, {
        //     method: 'PUT',
        //     headers: {
        //         'Content-Type': 'application/json' // или 'application/x-www-form-urlencoded'
        //         // Авторизация, если нужна
        //     },
        //     body: JSON.stringify({ status: '2' }) // Отправляем новый статус
        // });
        //
        // if (response.ok) {
        //     console.log(`Заявка ${requestId} отклонена.`);
        //     // TODO: Обновить интерфейс: удалить этот блок заявки или изменить его внешний вид
        //     // event.target.closest('.application-request-item').remove(); // Пример удаления блока
        // } else {
        //     console.error(`Ошибка при отклонении заявки ${requestId}: ${response.status}`);
        //     alert(`Не удалось отклонить заявку ${requestId}.`);
        // }
    
        // После обработки (одобрения/отклонения) можно обновить список заявок
        // fetchAndDisplayPendingApplicationRequests();
    }
    
    
    // Вызываем функцию для загрузки и отображения заявок со статусом 0, когда страница загрузится
    document.addEventListener('DOMContentLoaded', fetchAndDisplayPendingApplicationRequests);
    </script>